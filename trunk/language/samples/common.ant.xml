<project name="samples-common">
	<property name="gwt.root" location="../.." />
	<property name="project.tail" value="samples/${sample.root}" />
	<import file="${gwt.root}/common.ant.xml" />

	<property name="sample.package" value="${sample.root}" />
	<property name="sample.main" value="${sample.module}" />

	<target name="compile" description="Compile all java files">
		<mkdir dir="war/WEB-INF/classes" />
		<gwt.javac destdir="war/WEB-INF/classes">
			<classpath>
				<pathelement location="${gwt.google.apis.jar}"/>
				<pathelement location="${gwt.user.jar}" />
				<pathelement location="${gwt.dev.jar}" />
			</classpath>
		</gwt.javac>
	</target>

	<target name="gwtc" description="Compile to JavaScript">
		<outofdate>
			<sourcefiles>
				<fileset dir="src" />
				<fileset file="${gwt.google.apis.jar}"/>
				<fileset file="${gwt.user.jar}" />
				<fileset file="${gwt.dev.jar}" />
			</sourcefiles>
			<targetfiles path="$war/${sample.package}/${sample.module}.nocache.js" />
			<sequential>
				<mkdir dir="war" />
				<java dir="." classname="com.google.gwt.dev.Compiler" classpath="src:war/WEB-INF/classes:${gwt.user.jar}:${gwt.dev.jar}:${gwt.google.apis.jar}" fork="yes" failonerror="true" maxmemory="512m">
					<arg value="-war" />
					<arg file="war" />
					<arg value="com.google.gwt.${sample.api}.sample.${sample.package}.${sample.module}" />
				</java>
			</sequential>
		</outofdate>
	</target>

	<target name="devmode" depends="compile" description="Run development mode">
		<java failonerror="true" fork="true" classname="com.google.gwt.dev.DevMode">
			<classpath>
				<pathelement location="src"/>
				<pathelement location="war/WEB-INF/classes"/>
				<pathelement location="${gwt.dev.jar}"/>
				<pathelement location="${gwt.user.jar}"/>
				<pathelement location="${gwt.google.apis.jar}"/>
			</classpath>
			<jvmarg value="-Xmx512M"/>
			<arg value="com.google.gwt.${sample.api}.sample.${sample.package}.${sample.module}" />
		</java>
	</target>

	<target name="war" depends="compile, gwtc" description="Create a war file">
		<zip destfile="${sample.root}.war">
			<zipfileset dir="war"/>
			<zipfileset dir="${gwt.home}" includes="gwt-servlet.jar" prefix="WEB-INF/lib"/>
			<zipfileset dir="${gwt.build.lib}" includes="gwt-${api.name}.jar" prefix="WEB-INF/lib"/>
		</zip>
	</target>

	<target name="build" depends="compile, gwtc" description="Build this project" />

	<target name="checkstyle" description="Static analysis of source">
		<gwt.checkstyle>
			<fileset dir="src" />
		</gwt.checkstyle>
	</target>

	<target name="clean" description="Cleans this project's intermediate and output files">
		<delete dir="war/${sample.root}"/>
		<delete dir="war/WEB-INF/classes"/>
		<delete file="${sample.root}.war"/>
	</target>
</project>
